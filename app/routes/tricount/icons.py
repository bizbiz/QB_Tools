# app/routes/tricount/icons.py
from flask import render_template, redirect, url_for, flash, request, jsonify
from app.routes.tricount import tricount_bp
from app.extensions import db
from app.models.tricount import Icon
from sqlalchemy.exc import IntegrityError
import random

# Liste d'√©mojis vari√©s par cat√©gories (environ 1000 √©mojis)
# app/utils/emoji_categories.py

EMOJI_CATEGORIES = {
    "Visages": [
        "üòÄ", "üòÉ", "üòÑ", "üòÅ", "üòÜ", "üòÖ", "üòÇ", "ü§£", "ü•≤", "‚ò∫Ô∏è", "üòä", "üòá", "üôÇ", "üôÉ", "üòâ", 
        "üòå", "üòç", "ü•∞", "üòò", "üòó", "üòô", "üòö", "üòã", "üòõ", "üòù", "üòú", "ü§™", "ü§®", "üßê", "ü§ì", 
        "üòé", "ü•∏", "ü§©", "ü•≥", "üòè", "üòí", "üòû", "üòî", "üòü", "üòï", "üôÅ", "‚òπÔ∏è", "üò£", "üòñ", "üò´", 
        "üò©", "ü•∫", "üò¢", "üò≠", "üò§", "üò†", "üò°", "ü§¨", "ü§Ø", "üò≥", "ü•µ", "ü•∂", "üò±", "üò®", "üò∞", 
        "üò•", "üòì", "ü§ó", "ü§î", "ü§≠", "ü§´", "ü§•", "üò∂", "üò∂‚Äçüå´Ô∏è", "üòê", "üòë", "üò¨", "üôÑ", "üòØ", "üò¶", 
        "üòß", "üòÆ", "üò≤", "ü•±", "üò¥", "ü§§", "üò™", "üòµ", "üòµ‚Äçüí´", "ü§ê", "ü•¥", "ü§¢", "ü§Æ", "ü§ß", "üò∑", 
        "ü§í", "ü§ï", "ü§ë", "ü§†", "üòà", "üëø", "üëπ", "üë∫", "ü§°", "üí©", "üëª", "üíÄ", "‚ò†Ô∏è", "üëΩ", "üëæ", 
        "ü§ñ", "üéÉ", "üò∫", "üò∏", "üòπ", "üòª", "üòº", "üòΩ", "üôÄ", "üòø", "üòæ"
    ],
    
    "Personnes": [
        "üë∂", "üëß", "üßí", "üë¶", "üë©", "üßë", "üë®", "üë©‚Äçü¶±", "üßë‚Äçü¶±", "üë®‚Äçü¶±", "üë©‚Äçü¶∞", "üßë‚Äçü¶∞", "üë®‚Äçü¶∞",
        "üë±‚Äç‚ôÄÔ∏è", "üë±", "üë±‚Äç‚ôÇÔ∏è", "üë©‚Äçü¶≥", "üßë‚Äçü¶≥", "üë®‚Äçü¶≥", "üë©‚Äçü¶≤", "üßë‚Äçü¶≤", "üë®‚Äçü¶≤", "üßî‚Äç‚ôÄÔ∏è", "üßî", 
        "üßî‚Äç‚ôÇÔ∏è", "üëµ", "üßì", "üë¥", "üë≤", "üë≥‚Äç‚ôÄÔ∏è", "üë≥", "üë≥‚Äç‚ôÇÔ∏è", "üßï", "üëÆ‚Äç‚ôÄÔ∏è", "üëÆ", "üëÆ‚Äç‚ôÇÔ∏è", "üë∑‚Äç‚ôÄÔ∏è", 
        "üë∑", "üë∑‚Äç‚ôÇÔ∏è", "üíÇ‚Äç‚ôÄÔ∏è", "üíÇ", "üíÇ‚Äç‚ôÇÔ∏è", "üïµÔ∏è‚Äç‚ôÄÔ∏è", "üïµÔ∏è", "üïµÔ∏è‚Äç‚ôÇÔ∏è", "üë©‚Äç‚öïÔ∏è", "üßë‚Äç‚öïÔ∏è", "üë®‚Äç‚öïÔ∏è", "üë©‚Äçüåæ", 
        "üßë‚Äçüåæ", "üë®‚Äçüåæ", "üë©‚Äçüç≥", "üßë‚Äçüç≥", "üë®‚Äçüç≥", "üë©‚Äçüéì", "üßë‚Äçüéì", "üë®‚Äçüéì", "üë©‚Äçüé§", "üßë‚Äçüé§", "üë®‚Äçüé§", "üë©‚Äçüè´",
        "üßë‚Äçüè´", "üë®‚Äçüè´", "üë©‚Äçüè≠", "üßë‚Äçüè≠", "üë®‚Äçüè≠", "üë©‚Äçüíª", "üßë‚Äçüíª", "üë®‚Äçüíª", "üë©‚Äçüíº", "üßë‚Äçüíº", "üë®‚Äçüíº", "üë©‚Äçüîß", 
        "üßë‚Äçüîß", "üë®‚Äçüîß", "üë©‚Äçüî¨", "üßë‚Äçüî¨", "üë®‚Äçüî¨", "üë©‚Äçüé®", "üßë‚Äçüé®", "üë®‚Äçüé®", "üë©‚Äçüöí", "üßë‚Äçüöí", "üë®‚Äçüöí", "üë©‚Äç‚úàÔ∏è", 
        "üßë‚Äç‚úàÔ∏è", "üë®‚Äç‚úàÔ∏è", "üë©‚ÄçüöÄ", "üßë‚ÄçüöÄ", "üë®‚ÄçüöÄ", "üë©‚Äç‚öñÔ∏è", "üßë‚Äç‚öñÔ∏è", "üë®‚Äç‚öñÔ∏è", "üë∞‚Äç‚ôÄÔ∏è", "üë∞", "üë∞‚Äç‚ôÇÔ∏è", "ü§µ‚Äç‚ôÄÔ∏è",
        "ü§µ", "ü§µ‚Äç‚ôÇÔ∏è", "üë∏", "ü´Ö", "ü§¥", "ü•∑", "ü¶∏‚Äç‚ôÄÔ∏è", "ü¶∏", "ü¶∏‚Äç‚ôÇÔ∏è", "ü¶π‚Äç‚ôÄÔ∏è", "ü¶π", "ü¶π‚Äç‚ôÇÔ∏è", "ü§∂", "üßë‚ÄçüéÑ", 
        "üéÖ", "üßô‚Äç‚ôÄÔ∏è", "üßô", "üßô‚Äç‚ôÇÔ∏è", "üßù‚Äç‚ôÄÔ∏è", "üßù", "üßù‚Äç‚ôÇÔ∏è", "üßå", "üßõ‚Äç‚ôÄÔ∏è", "üßõ", "üßõ‚Äç‚ôÇÔ∏è", "üßü‚Äç‚ôÄÔ∏è", "üßü",
        "üßü‚Äç‚ôÇÔ∏è", "üßû‚Äç‚ôÄÔ∏è", "üßû", "üßû‚Äç‚ôÇÔ∏è", "üßú‚Äç‚ôÄÔ∏è", "üßú", "üßú‚Äç‚ôÇÔ∏è", "üßö‚Äç‚ôÄÔ∏è", "üßö", "üßö‚Äç‚ôÇÔ∏è", "üëº", "ü§∞", "ü´Ñ", 
        "ü´É", "ü§±", "üë©‚Äçüçº", "üßë‚Äçüçº", "üë®‚Äçüçº", "üôá‚Äç‚ôÄÔ∏è", "üôá", "üôá‚Äç‚ôÇÔ∏è", "üíÅ‚Äç‚ôÄÔ∏è", "üíÅ", "üíÅ‚Äç‚ôÇÔ∏è", "üôÖ‚Äç‚ôÄÔ∏è", "üôÖ", 
        "üôÖ‚Äç‚ôÇÔ∏è", "üôÜ‚Äç‚ôÄÔ∏è", "üôÜ", "üôÜ‚Äç‚ôÇÔ∏è", "üôã‚Äç‚ôÄÔ∏è", "üôã", "üôã‚Äç‚ôÇÔ∏è", "üßè‚Äç‚ôÄÔ∏è", "üßè", "üßè‚Äç‚ôÇÔ∏è", "ü§¶‚Äç‚ôÄÔ∏è", "ü§¶", "ü§¶‚Äç‚ôÇÔ∏è", 
        "ü§∑‚Äç‚ôÄÔ∏è", "ü§∑", "ü§∑‚Äç‚ôÇÔ∏è", "üôé‚Äç‚ôÄÔ∏è", "üôé", "üôé‚Äç‚ôÇÔ∏è", "üôç‚Äç‚ôÄÔ∏è", "üôç", "üôç‚Äç‚ôÇÔ∏è", "üíá‚Äç‚ôÄÔ∏è", "üíá", "üíá‚Äç‚ôÇÔ∏è", "üíÜ‚Äç‚ôÄÔ∏è", 
        "üíÜ", "üíÜ‚Äç‚ôÇÔ∏è", "üßñ‚Äç‚ôÄÔ∏è", "üßñ", "üßñ‚Äç‚ôÇÔ∏è", "üíÖ", "ü§≥", "üíÉ", "üï∫", "üëØ‚Äç‚ôÄÔ∏è", "üëØ", "üëØ‚Äç‚ôÇÔ∏è", "üï¥", "üë©‚Äçü¶Ω", 
        "üßë‚Äçü¶Ω", "üë®‚Äçü¶Ω", "üë©‚Äçü¶º", "üßë‚Äçü¶º", "üë®‚Äçü¶º", "üö∂‚Äç‚ôÄÔ∏è", "üö∂", "üö∂‚Äç‚ôÇÔ∏è", "üë©‚Äçü¶Ø", "üßë‚Äçü¶Ø", "üë®‚Äçü¶Ø", "üßé‚Äç‚ôÄÔ∏è",
        "üßé", "üßé‚Äç‚ôÇÔ∏è", "üèÉ‚Äç‚ôÄÔ∏è", "üèÉ", "üèÉ‚Äç‚ôÇÔ∏è", "üßç‚Äç‚ôÄÔ∏è", "üßç", "üßç‚Äç‚ôÇÔ∏è", "üë≠", "üßë‚Äçü§ù‚Äçüßë", "üë¨", "üë´", "üë©‚Äç‚ù§Ô∏è‚Äçüë©",
        "üíë", "üë®‚Äç‚ù§Ô∏è‚Äçüë®", "üë©‚Äç‚ù§Ô∏è‚Äçüë®", "üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©", "üíè", "üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®", "üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®", "üë™", "üë®‚Äçüë©‚Äçüëß", "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
        "üë®‚Äçüë©‚Äçüë¶‚Äçüë¶", "üë®‚Äçüë©‚Äçüëß‚Äçüëß", "üë®‚Äçüë®‚Äçüë¶", "üë®‚Äçüë®‚Äçüëß", "üë®‚Äçüë®‚Äçüëß‚Äçüë¶", "üë®‚Äçüë®‚Äçüë¶‚Äçüë¶", "üë®‚Äçüë®‚Äçüëß‚Äçüëß", "üë©‚Äçüë©‚Äçüë¶", 
        "üë©‚Äçüë©‚Äçüëß", "üë©‚Äçüë©‚Äçüëß‚Äçüë¶", "üë©‚Äçüë©‚Äçüë¶‚Äçüë¶", "üë©‚Äçüë©‚Äçüëß‚Äçüëß", "üë®‚Äçüë¶", "üë®‚Äçüë¶‚Äçüë¶", "üë®‚Äçüëß", "üë®‚Äçüëß‚Äçüë¶", "üë®‚Äçüëß‚Äçüëß",
        "üë©‚Äçüë¶", "üë©‚Äçüë¶‚Äçüë¶", "üë©‚Äçüëß", "üë©‚Äçüëß‚Äçüë¶", "üë©‚Äçüëß‚Äçüëß", "üó£", "üë§", "üë•", "ü´Ç"
    ],
    
    "Gestes": [
        "üëã", "ü§ö", "üñê", "‚úã", "üññ", "üëå", "ü§å", "ü§è", "‚úåÔ∏è", "ü§û", "ü´∞", "ü§ü", "ü§ò", "ü§ô", "üëà", 
        "üëâ", "üëÜ", "üñï", "üëá", "‚òùÔ∏è", "üëç", "üëé", "‚úä", "üëä", "ü§õ", "ü§ú", "üëè", "üôå", "üëê", "ü§≤", 
        "ü§ù", "üôè", "‚úçÔ∏è", "üíÖ", "ü§≥", "üí™", "ü¶æ", "ü¶µ", "ü¶ø", "ü¶∂", "üë£", "üëÇ", "ü¶ª", "üëÉ", "ü´Ä", 
        "ü´Å", "üß†", "ü¶∑", "ü¶¥", "üëÄ", "üëÅ", "üëÖ", "üëÑ", "ü´¶", "üíã", "ü©∏"
    ],
    
    "V√™tements": [
        "üß•", "üëö", "üëï", "üëñ", "ü©≤", "ü©≥", "üëî", "üëó", "üëô", "ü©±", "üëò", "ü•ª", "ü©¥", "ü•ø", "üë†", 
        "üë°", "üë¢", "üëû", "üëü", "ü•æ", "üß¶", "üß§", "üß£", "üé©", "üß¢", "üëí", "üéì", "‚õë", "ü™ñ", "üëë", 
        "üëù", "üëõ", "üëú", "üíº", "üéí", "üß≥", "üëì", "üï∂", "ü•Ω", "üåÇ", "üíç", "üíÑ", "üíã"
    ],
    
    "Animaux": [
        "üê∂", "üê±", "üê≠", "üêπ", "üê∞", "ü¶ä", "üêª", "üêº", "üêª‚Äç‚ùÑÔ∏è", "üê®", "üêØ", "ü¶Å", "üêÆ", "üê∑", "üêΩ", 
        "üê∏", "üêµ", "üôà", "üôâ", "üôä", "üêí", "üêî", "üêß", "üê¶", "üê§", "üê£", "üê•", "ü¶Ü", "ü¶Ö", "ü¶â", 
        "ü¶á", "üê∫", "üêó", "üê¥", "ü¶Ñ", "üêù", "ü™±", "üêõ", "ü¶ã", "üêå", "üêû", "üêú", "ü™∞", "ü™≤", "ü™≥", 
        "ü¶ü", "ü¶ó", "üï∑Ô∏è", "üï∏Ô∏è", "ü¶Ç", "üê¢", "üêç", "ü¶é", "ü¶ñ", "ü¶ï", "üêô", "ü¶ë", "ü¶ê", "ü¶û", "ü¶Ä", 
        "üê°", "üê†", "üêü", "üê¨", "üê≥", "üêã", "ü¶à", "üêä", "üêÖ", "üêÜ", "ü¶ì", "ü¶ç", "ü¶ß", "ü¶£", "üêò", 
        "ü¶õ", "ü¶è", "üê™", "üê´", "ü¶í", "ü¶ò", "ü¶¨", "üêÉ", "üêÇ", "üêÑ", "üêé", "üêñ", "üêè", "üêë", "ü¶ô", 
        "üêê", "ü¶å", "üêï", "üê©", "ü¶Æ", "üêï‚Äçü¶∫", "üêà", "üêà‚Äç‚¨õ", "ü™∂", "üêì", "ü¶É", "ü¶§", "ü¶ö", "ü¶ú", 
        "ü¶¢", "ü¶©", "üïäÔ∏è", "üêá", "ü¶ù", "ü¶®", "ü¶°", "ü¶¶", "ü¶´", "ü¶≠", "üêøÔ∏è", "ü¶î"
    ],
    
    "Nourriture": [
        "üçá", "üçà", "üçâ", "üçä", "üçã", "üçå", "üçç", "ü•≠", "üçé", "üçè", "üçê", "üçë", "üçí", "üçì", "ü´ê", 
        "ü•ù", "üçÖ", "ü´í", "ü••", "ü•ë", "üçÜ", "ü•î", "ü•ï", "üåΩ", "üå∂Ô∏è", "ü´ë", "ü•í", "ü•¨", "ü•¶", "üßÑ", 
        "üßÖ", "üçÑ", "ü•ú", "ü´ò", "üå∞", "üçû", "ü•ê", "ü•ñ", "ü´ì", "ü•®", "ü•Ø", "ü•û", "üßá", "üßÄ", "üçñ", 
        "üçó", "ü•©", "ü•ì", "üçî", "üçü", "üçï", "üå≠", "ü•™", "üåÆ", "üåØ", "ü´î", "ü•ô", "üßÜ", "ü•ö", "üç≥", 
        "ü•ò", "üç≤", "ü´ï", "ü•£", "ü•ó", "üçø", "üßà", "üßÇ", "ü•´", "üç±", "üçò", "üçô", "üçö", "üçõ", "üçú", 
        "üçù", "üç†", "üç¢", "üç£", "üç§", "üç•", "ü•Æ", "üç°", "ü•ü", "ü•†", "ü•°", "ü¶™", "üç¶", "üçß", "üç®", 
        "üç©", "üç™", "üéÇ", "üç∞", "üßÅ", "ü•ß", "üç´", "üç¨", "üç≠", "üçÆ", "üçØ", "üçº", "ü•õ", "‚òï", "ü´ñ", 
        "üçµ", "üç∂", "üçæ", "üç∑", "üç∏", "üçπ", "üç∫", "üçª", "ü•Ç", "ü•É", "ü´ó", "ü•§", "üßã", "üßÉ", "üßâ", 
        "üßä", "ü•¢", "üçΩÔ∏è", "üç¥", "ü•Ñ", "üî™", "ü´ô", "üè∫"
    ],
    
    "Transport": [
        "üöó", "üöï", "üöô", "üöå", "üöé", "üèéÔ∏è", "üöì", "üöë", "üöí", "üöê", "üõª", "üöö", "üöõ", "üöú", "üõµ", 
        "üèçÔ∏è", "üõ∫", "üö≤", "üõ¥", "üõπ", "üõº", "üöè", "üö¶", "üö•", "üöß", "üõë", "‚öì", "üö¢", "‚õ¥Ô∏è", "üõ•Ô∏è", 
        "üö§", "üõ≥Ô∏è", "‚õµ", "üö£", "üöÅ", "üõ©Ô∏è", "‚úàÔ∏è", "üöÄ", "üõ∏", "üöá", "üöä", "üöâ", "üöà", "üöÇ", "üöÜ", 
        "üöÖ", "üöÑ", "üöù", "üöû", "üöÉ", "üöü", "üö†", "üö°", "üöñ", "üöò", "üöî", "üöç", "üöò", "üöñ", "üöã", 
        "üöÖ", "üöÜ", "üöá", "üöà", "üöâ", "üöä", "üöù", "üöû", "üöã", "üöå", "üöç", "üöé", "üöê", "üöë", "üöí"
    ],
    
    "Lieux": [
        "üèôÔ∏è", "üåÉ", "üåâ", "üèûÔ∏è", "üèúÔ∏è", "üèùÔ∏è", "üèïÔ∏è", "üèñÔ∏è", "üèóÔ∏è", "üèòÔ∏è", "üèöÔ∏è", "üèõÔ∏è", "üèüÔ∏è", "üè†", 
        "üè°", "üè¢", "üè£", "üè§", "üè•", "üè¶", "üè®", "üè©", "üè™", "üè´", "üè¨", "üè≠", "üèØ", "üè∞", "üíí", 
        "üóº", "üóΩ", "‚õ™", "üïå", "üïç", "‚õ©Ô∏è", "üïã", "‚õ≤", "‚õ∫", "üèôÔ∏è", "üåÑ", "üåÖ", "üåÜ", "üåá", "üåà", 
        "üé¢", "üé°", "üé™", "üé≠", "üñºÔ∏è", "üé®", "üé∞", "üöÇ", "üöÉ", "üöÑ", "üöÖ", "üöÜ", "üöá", "üöà", "üöâ", 
        "üöä", "üöù", "üöû", "üöã", "üöå", "üöç", "üöé", "üöê", "üåÅ", "üåÉ", "üèôÔ∏è", "üåÑ", "üåÖ", "üåÜ", "üåá", 
        "üåâ", "üåå", "üèîÔ∏è", "‚õ∞Ô∏è", "üóª", "üèïÔ∏è", "üèñÔ∏è", "üèúÔ∏è", "üèùÔ∏è", "üèûÔ∏è", "üèüÔ∏è", "üèõÔ∏è", "üèóÔ∏è", "üß±", 
        "üèòÔ∏è", "üèöÔ∏è", "üè†", "üè°", "üè¢", "üè£", "üè§", "üè•", "üè¶", "üè®", "üè©", "üè™", "üè´", "üè¨", "üè≠", 
        "üèØ", "üè∞", "üíí", "üóº", "üóΩ", "‚õ™", "üïå", "üïç", "‚õ©Ô∏è", "üïã", "‚õ≤", "‚õ∫", "üåÅ", "üè≠", "‚öì", "üèüÔ∏è"
    ],
    
    "M√©t√©o": [
        "üå°Ô∏è", "‚òÄÔ∏è", "üå§Ô∏è", "‚õÖ", "üå•Ô∏è", "‚òÅÔ∏è", "üå¶Ô∏è", "üåßÔ∏è", "‚õàÔ∏è", "üå©Ô∏è", "üå®Ô∏è", "‚ùÑÔ∏è", "‚òÉÔ∏è", "‚õÑ", "üå¨Ô∏è", 
        "üí®", "üå™Ô∏è", "üå´Ô∏è", "üåä", "üíß", "üí¶", "‚òî", "‚ö°", "‚ùÑÔ∏è", "‚òÉÔ∏è", "‚õÑ", "üî•", "üí•", "‚ú®", "‚≠ê", 
        "üåü", "üí´", "‚ö°", "‚òÑÔ∏è", "üí•", "üî•", "üåà", "‚òÄÔ∏è", "üå§Ô∏è", "‚õÖ", "üå•Ô∏è", "‚òÅÔ∏è", "üå¶Ô∏è", "üåßÔ∏è", "‚õàÔ∏è", 
        "üå©Ô∏è", "üå®Ô∏è", "‚òÉÔ∏è", "‚õÑ", "‚ùÑÔ∏è", "üå¨Ô∏è", "üí®", "üåä", "üå´Ô∏è", "üåù", "üåö", "üåë", "üåí", "üåì", "üåî", 
        "üåï", "üåñ", "üåó", "üåò", "üåô", "ü™ê", "‚ö°"
    ],
    
    "Plantes": [
        "üå±", "üå≤", "üå≥", "üå¥", "üåµ", "üåæ", "üåø", "‚òòÔ∏è", "üçÄ", "üçÅ", "üçÇ", "üçÉ", "üå∑", "üåπ", "ü•Ä", 
        "üå∫", "üå∏", "üåº", "üåª", "üíê", "üå±", "ü™¥", "üå≤", "üå≥", "üå¥", "üåµ", "üåæ", "üåø", "‚òòÔ∏è", "üçÄ", 
        "üçÅ", "üçÇ", "üçÉ", "ü™®", "ü™µ", "üåµ", "üå¥", "üå≤", "üå≥", "üå±", "üåø", "üçÄ", "ü™¥", "ü™¶", "üå∑", 
        "üåπ", "ü•Ä", "üå∫", "üå∏", "üåº", "üåª", "üíê"
    ],
    
    "Objets": [
        "üì±", "üíª", "‚åö", "‚å®Ô∏è", "üñ•Ô∏è", "üñ®Ô∏è", "üíø", "üíæ", "üìÄ", "üé•", "üé¨", "üì∫", "üì∑", "üìπ", "üîç", 
        "üîé", "üî¨", "üî≠", "üì°", "üîã", "üîå", "üí°", "üî¶", "üïØÔ∏è", "üßØ", "üõ¢Ô∏è", "üí∏", "üíµ", "üí¥", "üí∂", 
        "üí∑", "üí∞", "üí≥", "üíé", "‚öñÔ∏è", "üß∞", "üîß", "üî®", "‚öíÔ∏è", "üõ†Ô∏è", "‚õèÔ∏è", "üî©", "‚öôÔ∏è", "üß±", "‚õìÔ∏è", 
        "üß≤", "üî´", "üí£", "üß®", "ü™ì", "üî™", "üó°Ô∏è", "‚öîÔ∏è", "üõ°Ô∏è", "üö¨", "‚ö∞Ô∏è", "‚ö±Ô∏è", "üè∫", "üîÆ", "üìø", 
        "üßø", "üíà", "‚öóÔ∏è", "üî≠", "üî¨", "üï≥Ô∏è", "üíä", "üíâ", "ü©∏", "ü©π", "ü©∫", "üîñ", "üß∑", "üìç", "üìå", 
        "üìé", "üñáÔ∏è", "üìè", "üìê", "‚úÇÔ∏è", "üßÆ", "üóÉÔ∏è", "üóÑÔ∏è", "üóëÔ∏è", "üîí", "üîì", "üîè", "üîê", "üîë", "üóùÔ∏è", 
        "üî®", "ü™ì", "‚õèÔ∏è", "‚öíÔ∏è", "üõ†Ô∏è", "üó°Ô∏è", "‚öîÔ∏è", "üî´", "üèπ", "üõ°Ô∏è", "ü™ö", "üîß", "ü™õ", "üî©", "‚öôÔ∏è", 
        "üóúÔ∏è", "‚öñÔ∏è", "ü¶Ø", "üîó", "‚õìÔ∏è", "üß∞", "üß≤", "üß™", "üß´", "üß¨", "üî¨", "üî≠", "üì°", "üíâ", "ü©∏", 
        "ü©π", "ü©∫", "ü©ª", "ü©º", "ü™Æ", "ü™¢", "üß∂", "üßµ", "ü™°", "üß∑", "üìå", "üìç", "üßÆ", "üñáÔ∏è", "üìé"
    ],
    
    "Symboles": [
        "‚ôà", "‚ôâ", "‚ôä", "‚ôã", "‚ôå", "‚ôç", "‚ôé", "‚ôè", "‚ôê", "‚ôë", "‚ôí", "‚ôì", "‚õé", "üîÄ", "üîÅ", "üîÇ", "‚è©", 
        "‚è≠Ô∏è", "‚èØÔ∏è", "‚óÄÔ∏è", "‚è™", "‚èÆÔ∏è", "üîº", "‚è´", "üîΩ", "‚è¨", "‚è∏Ô∏è", "‚èπÔ∏è", "‚è∫Ô∏è", "‚èèÔ∏è", "üé¶", "üîÖ", 
        "üîÜ", "üì∂", "üì≥", "üì¥", "‚ôæÔ∏è", "‚ôªÔ∏è", "‚öúÔ∏è", "üî±", "üìõ", "üî∞", "‚≠ï", "‚úÖ", "‚òëÔ∏è", "‚úîÔ∏è", "‚ùå", 
        "‚ùé", "‚û∞", "‚ûø", "„ÄΩÔ∏è", "‚ú≥Ô∏è", "‚ú¥Ô∏è", "‚ùáÔ∏è", "¬©Ô∏è", "¬ÆÔ∏è", "‚Ñ¢Ô∏è", "üîü", "üî¢", "üî£", "üî§", "üÖ∞Ô∏è", 
        "üÜé", "üÖ±Ô∏è", "üÜë", "üÜí", "üÜì", "üÜî", "üÜï", "üÜñ", "üÜó", "üÜò", "üÜô", "üÜö", "üàÅ", "üàÇÔ∏è", "üà∑Ô∏è", 
        "üà∂", "üàØ", "üâê", "üàπ", "üàö", "üà≤", "üâë", "üà∏", "üà¥", "üà≥", "„äóÔ∏è", "„äôÔ∏è", "üà∫", "üàµ", "üî¥", 
        "üü†", "üü°", "üü¢", "üîµ", "üü£", "üü§", "‚ö´", "‚ö™", "üü•", "üüß", "üü®", "üü©", "üü¶", "üü™", "üü´"
    ],

    "Activit√©s": [
        "üéØ", "üéÆ", "üé≤", "üß©", "üé≠", "üé®", "üé§", "üéß", "üéº", "üéπ", "ü•Å", "üé∑", "üé∫", "üé∏", "ü™ï", 
        "üéª", "üé¨", "üèπ", "ü•å", "üõ∑", "üéø", "‚õ∏Ô∏è", "üõº", "ü©∞", "üéΩ", "üéæ", "üèâ", "üèà", "üèê", "üèÄ", 
        "‚öæ", "ü•é", "üèè", "üèë", "üèí", "ü•ç", "üèì", "üè∏", "ü•ä", "ü•ã", "ü•Ö", "‚õ≥", "‚õ∏Ô∏è", "üé£", "üéΩ", 
        "üéø", "üõ∑", "ü•å", "üéØ", "ü™Ä", "ü™Å", "üé±", "üéÆ", "üé∞", "üé≤", "üß©", "‚ôüÔ∏è", "üé≠", "üé®", "üßµ", 
        "üß∂", "üéº", "üé§", "üéß", "üé∑", "üé∏", "üéπ", "üé∫", "üéª", "ü•Å", "ü™ò", "ü™ó", "ü™ï"
    ],
    
    "Sports": [
        "‚öΩ", "üèÄ", "üèà", "‚öæ", "ü•é", "üéæ", "üèê", "üèâ", "ü•è", "üé±", "ü™Ä", "üèì", "üè∏", "üèí", "üèë", 
        "ü•ç", "üèè", "ü™É", "ü•Ö", "‚õ≥", "ü™Å", "üèπ", "üé£", "ü§ø", "ü•ä", "ü•ã", "üéΩ", "üõπ", "üõº", "üõ∑", 
        "‚õ∏Ô∏è", "ü•å", "üéø", "‚õ∑Ô∏è", "üèÇ", "ü™Ç", "üèãÔ∏è", "üèãÔ∏è‚Äç‚ôÄÔ∏è", "üèãÔ∏è‚Äç‚ôÇÔ∏è", "ü§º", "ü§º‚Äç‚ôÄÔ∏è", "ü§º‚Äç‚ôÇÔ∏è", "ü§∏", 
        "ü§∏‚Äç‚ôÄÔ∏è", "ü§∏‚Äç‚ôÇÔ∏è", "‚õπÔ∏è", "‚õπÔ∏è‚Äç‚ôÄÔ∏è", "‚õπÔ∏è‚Äç‚ôÇÔ∏è", "ü§∫", "ü§æ", "ü§æ‚Äç‚ôÄÔ∏è", "ü§æ‚Äç‚ôÇÔ∏è", "üèåÔ∏è", "üèåÔ∏è‚Äç‚ôÄÔ∏è", "üèåÔ∏è‚Äç‚ôÇÔ∏è", 
        "üèá", "üßò", "üßò‚Äç‚ôÄÔ∏è", "üßò‚Äç‚ôÇÔ∏è", "üèÑ", "üèÑ‚Äç‚ôÄÔ∏è", "üèÑ‚Äç‚ôÇÔ∏è", "üèä", "üèä‚Äç‚ôÄÔ∏è", "üèä‚Äç‚ôÇÔ∏è", "ü§Ω", "ü§Ω‚Äç‚ôÄÔ∏è", 
        "ü§Ω‚Äç‚ôÇÔ∏è", "üö£", "üö£‚Äç‚ôÄÔ∏è", "üö£‚Äç‚ôÇÔ∏è", "üßó", "üßó‚Äç‚ôÄÔ∏è", "üßó‚Äç‚ôÇÔ∏è", "üöµ", "üöµ‚Äç‚ôÄÔ∏è", "üöµ‚Äç‚ôÇÔ∏è", "üö¥", "üö¥‚Äç‚ôÄÔ∏è", 
        "üö¥‚Äç‚ôÇÔ∏è", "üèÜ", "ü•á", "ü•à", "ü•â", "üèÖ", "üéñÔ∏è", "üèµÔ∏è", "üéóÔ∏è", "üé™", "ü§π", "ü§π‚Äç‚ôÄÔ∏è", "ü§π‚Äç‚ôÇÔ∏è"
    ],
    
    "Communication": [
        "üì¢", "üì£", "üìØ", "üîî", "üîï", "üì±", "üì≤", "‚òéÔ∏è", "üìû", "üìü", "üì†", "üîã", "üîå", "üíª", "üñ•Ô∏è", 
        "üñ®Ô∏è", "‚å®Ô∏è", "üñ±Ô∏è", "üñ≤Ô∏è", "üíΩ", "üíæ", "üíø", "üìÄ", "üßÆ", "üé•", "üéûÔ∏è", "üìΩÔ∏è", "üé¨", "üì∫", "üì∑", 
        "üì∏", "üìπ", "üìº", "üîç", "üîé", "üïØÔ∏è", "üí°", "üî¶", "üèÆ", "ü™î", "üìî", "üìï", "üìñ", "üìó", "üìò", 
        "üìô", "üìö", "üìì", "üìí", "üìÉ", "üìú", "üìÑ", "üì∞", "üóûÔ∏è", "üìë", "üîñ", "üè∑Ô∏è", "üí∞", "ü™ô", "üí¥", 
        "üíµ", "üí∂", "üí∑", "üí∏", "üí≥", "üßæ", "‚úâÔ∏è", "üìß", "üì®", "üì©", "üì§", "üì•", "üì¶", "üì´", "üì™", 
        "üì¨", "üì≠", "üìÆ", "üó≥Ô∏è", "‚úèÔ∏è", "‚úíÔ∏è", "üñãÔ∏è", "üñäÔ∏è", "üñåÔ∏è", "üñçÔ∏è", "üìù", "üìÅ", "üìÇ", "üóÇÔ∏è", "üìÖ", 
        "üìÜ", "üóíÔ∏è", "üóìÔ∏è", "üìá", "üìà", "üìâ", "üìä", "üìã", "üìå", "üìç", "üìé", "üñáÔ∏è", "üìè", "üìê", "‚úÇÔ∏è", 
        "üóÉÔ∏è", "üóÑÔ∏è", "üóëÔ∏è", "üîí", "üîì", "üîè", "üîê", "üîë", "üóùÔ∏è", "üî®", "ü™ì", "‚õèÔ∏è", "‚öíÔ∏è", "üõ†Ô∏è"
    ],
    
    "M√©dical": [
        "üíä", "üíâ", "ü©∏", "ü©π", "ü©∫", "ü©ª", "ü©º", "ü´Å", "ü´Ä", "üß†", "ü¶¥", "ü¶∑", "üëÅÔ∏è", "üëÇ", "ü¶ª", 
        "üëÉ", "üëÖ", "üëÑ", "ü´¶", "üë§", "üë•", "ü´Ç", "üè•", "üßë‚Äç‚öïÔ∏è", "üë®‚Äç‚öïÔ∏è", "üë©‚Äç‚öïÔ∏è"
    ],
    
    "Horloges": [
        "üïõ", "üïß", "üïê", "üïú", "üïë", "üïù", "üïí", "üïû", "üïì", "üïü", "üïî", "üï†", "üïï", "üï°", "üïñ", 
        "üï¢", "üïó", "üï£", "üïò", "üï§", "üïô", "üï•", "üïö", "üï¶", "‚è±Ô∏è", "‚è≤Ô∏è", "‚è∞", "üï∞Ô∏è", "‚åö", "‚è≥", "‚åõ"
    ],
    
    "C≈ìurs": [
        "‚ù§Ô∏è", "üß°", "üíõ", "üíö", "üíô", "üíú", "üñ§", "ü§ç", "ü§é", "‚ù§Ô∏è‚Äçüî•", "‚ù§Ô∏è‚Äçü©π", "üíî", "‚ù£Ô∏è", "üíï", 
        "üíû", "üíì", "üíó", "üíñ", "üíò", "üíù", "üíü"
    ]
}

@tricount_bp.route('/icons')
def icons_list():
    """Liste des ic√¥nes disponibles"""
    icons = Icon.query.all()
    
    # R√©cup√©rer tous les √©mojis utilis√©s dans la base de donn√©es
    used_emojis = {icon.unicode_emoji for icon in icons}
    
    # S√©lectionner 100 √©mojis al√©atoires qui ne sont pas d√©j√† utilis√©s
    available_emojis = []
    
    # Aplatir toutes les cat√©gories d'√©mojis en une seule liste
    all_emojis = []
    for category, emoji_list in EMOJI_CATEGORIES.items():
        all_emojis.extend(emoji_list)
    
    # Filtrer les √©mojis non utilis√©s
    unused_emojis = [emoji for emoji in all_emojis if emoji not in used_emojis]
    
    # Si nous avons plus de 100 √©mojis disponibles, s√©lectionner 100 al√©atoirement
    if len(unused_emojis) > 9000:
        suggested_emojis = random.sample(unused_emojis, 9000)
    else:
        suggested_emojis = unused_emojis
    
    # Organiser les √©mojis sugg√©r√©s par cat√©gorie pour l'affichage
    suggested_by_category = {}
    for category, emoji_list in EMOJI_CATEGORIES.items():
        category_suggestions = [emoji for emoji in suggested_emojis if emoji in emoji_list]
        if category_suggestions:
            suggested_by_category[category] = category_suggestions
    
    return render_template('tricount/icons.html', 
                          icons=icons, 
                          emoji_categories=EMOJI_CATEGORIES,
                          suggested_emojis=suggested_emojis,
                          suggested_by_category=suggested_by_category)

@tricount_bp.route('/icons/add', methods=['POST'])
def add_icon():
    """Ajouter une nouvelle ic√¥ne"""
    name = request.form.get('name')
    description = request.form.get('description', '')
    font_awesome_class = request.form.get('font_awesome_class', '')  # Maintenant facultatif
    unicode_emoji = request.form.get('unicode_emoji')
    
    if not name or not unicode_emoji:
        flash('Le nom et l\'emoji Unicode sont requis.', 'warning')
        return redirect(url_for('tricount.icons_list'))
    
    icon = Icon(
        name=name, 
        description=description,
        font_awesome_class=font_awesome_class,  # Peut √™tre vide
        unicode_emoji=unicode_emoji
    )
    
    db.session.add(icon)
    
    try:
        db.session.commit()
        flash(f'Ic√¥ne "{name}" ajout√©e avec succ√®s.', 'success')
    except IntegrityError:
        db.session.rollback()
        flash(f'Une ic√¥ne avec le nom "{name}" existe d√©j√†.', 'danger')
    
    return redirect(url_for('tricount.icons_list'))

@tricount_bp.route('/icons/update/<int:icon_id>', methods=['POST'])
def update_icon(icon_id):
    """Mettre √† jour une ic√¥ne"""
    icon = Icon.query.get_or_404(icon_id)
    
    name = request.form.get('name')
    description = request.form.get('description', '')
    font_awesome_class = request.form.get('font_awesome_class', '')  # Maintenant facultatif
    unicode_emoji = request.form.get('unicode_emoji')
    
    if not name or not unicode_emoji:
        flash('Le nom et l\'emoji Unicode sont requis.', 'warning')
        return redirect(url_for('tricount.icons_list'))
    
    try:
        icon.name = name
        icon.description = description
        icon.font_awesome_class = font_awesome_class  # Peut √™tre vide
        icon.unicode_emoji = unicode_emoji
        
        db.session.commit()
        flash(f'Ic√¥ne "{name}" mise √† jour avec succ√®s.', 'success')
    except IntegrityError:
        db.session.rollback()
        flash(f'Une ic√¥ne avec le nom "{name}" existe d√©j√†.', 'danger')
    
    return redirect(url_for('tricount.icons_list'))

@tricount_bp.route('/icons/delete/<int:icon_id>', methods=['POST'])
def delete_icon(icon_id):
    """Supprimer une ic√¥ne"""
    icon = Icon.query.get_or_404(icon_id)
    
    try:
        db.session.delete(icon)
        db.session.commit()
        flash(f'Ic√¥ne "{icon.name}" supprim√©e avec succ√®s.', 'success')
    except Exception as e:
        db.session.rollback()
        flash(f'Erreur lors de la suppression de l\'ic√¥ne: {str(e)}', 'danger')
    
    return redirect(url_for('tricount.icons_list'))

@tricount_bp.route('/icons/api/list')
def get_icons():
    """API pour r√©cup√©rer la liste des ic√¥nes au format JSON"""
    icons = Icon.query.all()
    icons_data = [{
        'id': icon.id,
        'name': icon.name,
        'description': icon.description,
        'font_awesome_class': icon.font_awesome_class,
        'unicode_emoji': icon.unicode_emoji
    } for icon in icons]
    
    return jsonify({
        'success': True,
        'icons': icons_data
    })