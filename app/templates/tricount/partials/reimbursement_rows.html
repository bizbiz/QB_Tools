{# app/templates/tricount/partials/reimbursement_rows.html #}

{% from "macros/tricount/flag_macros.html" import flag_badge %}
{% from "macros/tricount/category_select.html" import category_badge %}
{% from "macros/tricount/expense_macros.html" import display_expense_name, display_expense_description %}

{% for expense in expenses %}
<tr data-expense-id="{{ expense.id }}" 
    class="{% if expense.declaration_status == 'declared' %}expense-declared{% endif %} 
    {% if expense.declaration_status == 'reimbursed' %}expense-reimbursed{% endif %}
    {% if not expense.is_reimbursable %}expense-not-reimbursable{% endif %}">
    <td>
        <div class="form-check">
            <input class="form-check-input expense-checkbox" type="checkbox" value="{{ expense.id }}"
                   {% if not expense.is_reimbursable %}disabled{% endif %}>
        </div>
    </td>
    <td data-sort-value="{{ expense.date.strftime('%Y%m%d') }}">
        {{ expense.date.strftime('%d/%m/%Y') }}
    </td>
    <td class="description-cell" data-sort-value="{{ display_expense_name(expense, show_original=false, sort_value=true) }}">
        <div class="fw-bold">
            {{ display_expense_name(expense, show_original=false) }}
        </div>
        <div class="small text-muted">
            {{ display_expense_description(expense, show_original=false, max_length=70) }}
        </div>
    </td>
    <td class="text-end {% if expense.is_debit %}text-danger{% else %}text-success{% endif %}" data-sort-value="{{ expense.amount }}">
        {% if expense.is_debit %}-{% endif %}{{ "%.2f"|format(expense.amount) }} €
    </td>
    <td>
        {% if expense.category %}
            {{ category_badge(expense.category, extra_classes='btn-sm') }}
        {% else %}
            <span class="badge bg-secondary">Non catégorisée</span>
        {% endif %}
    </td>
    <td class="text-center">
        {% if expense.flag %}
            {{ flag_badge(expense.flag, text_hidden=true, extra_classes='btn-sm') }}
        {% else %}
            <span class="badge bg-secondary">N/A</span>
        {% endif %}
    </td>
    <td class="text-center">
        <div class="form-check form-switch d-flex justify-content-center">
            <input class="form-check-input status-switch declared-switch" type="checkbox" 
                   {% if expense.declaration_status in ['declared', 'reimbursed'] %}checked{% endif %}
                   {% if not expense.is_reimbursable %}disabled{% endif %}
                   data-expense-id="{{ expense.id }}" data-status="declared">
        </div>
    </td>
    <td class="text-center">
        <div class="form-check form-switch d-flex justify-content-center">
            <input class="form-check-input status-switch reimbursed-switch" type="checkbox"
                   {% if expense.declaration_status == 'reimbursed' %}checked{% endif %}
                   {% if not expense.is_reimbursable %}disabled{% endif %}
                   data-expense-id="{{ expense.id }}" data-status="reimbursed">
        </div>
    </td>
    <td class="text-center">
        <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-primary view-expense-btn" data-expense-id="{{ expense.id }}">
                <i class="fas fa-eye"></i>
            </button>
            <button type="button" class="btn btn-outline-secondary edit-expense-btn" data-expense-id="{{ expense.id }}">
                <i class="fas fa-edit"></i>
            </button>
        </div>
    </td>
</tr>
{% else %}
<tr id="no-expenses-row">
    <td colspan="9" class="text-center py-4">
        <div class="alert alert-info mb-0">
            <i class="fas fa-info-circle me-2"></i>
            Aucune dépense trouvée avec les filtres appliqués. 
            <a href="#" class="reset-filters-link">Réinitialiser les filtres</a>.
        </div>
    </td>
</tr>
{% endfor %}